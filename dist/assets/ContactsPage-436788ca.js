import{d as O,u as z,B as E,r as d,o as y,c as A,w as e,a as t,b as a,R as U,e as j,a4 as J,f as L,W as G,ap as Q,i as g,t as q,j as X,k as Y,al as b,l as Z,O as W,_ as P,g as $,n as x,C as B,D as R,p as T,x as F,E as tt,J as et,q as V,F as H,a6 as C,S as at,aq as nt,ak as st,ar as ot,as as rt,s as lt,at as it,y as ct,z as ut,A as dt}from"./index-2f13bec8.js";import{g as ft,a as K,p as _t}from"./methods-607f4662.js";import{o as mt,S as ht,i as gt,j as N,k as pt,l as Ct}from"./ShowContactDetailsModal-2da7e897.js";const It={class:"image_container"},vt=["src"],wt=O({__name:"ContactElement",props:{user:String,avatar:String,user_id:String,email:String},setup(c){const r=c,o=z();E(!1);const I=E(null);function v(f,l,_){try{const n=new CustomEvent("openDialogue",{detail:{user:f,user_id:l,email:_}}),s=o.getAvatarUrlFromContactInformationForID(l),i=ft();if(o.activeChatsContainChatWithID(l))o.updateTimestampOfActiveChatWithID(l,i);else{const m={user:f,user_id:l,email:_,avatarUrl:s,lastAccessTimestamp:i};o.addToActiveChats(m),o.setCurrentDialoguePartner(m)}o.setLastActiveChatWasWithID(l),window.dispatchEvent(n)}catch(n){b.fire({title:"Error",text:"Dialog für Chat-Ansicht konnte nicht geöffnet werden"})}finally{Z.push("/tabs/dialogue")}}function w(f){try{const l=new CustomEvent("deleteUserWithId",{detail:{user_id:f}});window.dispatchEvent(l)}catch(l){b.fire({title:"Error",text:"Event zum Löschen des Nutzers konnte nicht veranlasst werden"})}o.resetCurrentDialoguePartner()}const D=async(f,l,_)=>{(await W.create({component:ht,componentProps:{avatarUrl:f,userId:l,email:_}})).present()};return mt(I,()=>{D(r.avatar,r.user_id,r.email)}),(f,l)=>{const _=d("ion-item-option"),n=d("ion-item-options"),s=d("ion-card-subtitle"),i=d("ion-item"),m=d("ion-item-sliding");return y(),A(m,null,{default:e(()=>[t(n,{side:"start"},{default:e(()=>[t(_,{color:"success"},{default:e(()=>[t(a(U),{slot:"icon-only",icon:a(j)},null,8,["icon"])]),_:1})]),_:1}),t(i,null,{default:e(()=>[t(a(J),{class:"onhover",ref_key:"htmlRef",ref:I,onClick:l[0]||(l[0]=u=>v(c.user,c.user_id,c.email))},{default:e(()=>[L("div",It,[L("img",{src:c.avatar,alt:"avatar"},null,8,vt)]),t(a(G),null,{default:e(()=>[t(a(Q),null,{default:e(()=>[g(q(c.user),1)]),_:1}),t(s,null,{default:e(()=>[g(q(c.user_id),1)]),_:1}),t(s,null,{default:e(()=>[g(q(c.email),1)]),_:1})]),_:1})]),_:1},512)]),_:1}),t(n,{side:"end"},{default:e(()=>[t(_,null,{default:e(()=>[t(a(U),{slot:"icon-only",icon:a(X)},null,8,["icon"])]),_:1}),t(_,{color:"danger",onClick:l[1]||(l[1]=u=>w(c.user_id))},{default:e(()=>[t(a(U),{slot:"icon-only",icon:a(Y)},null,8,["icon"])]),_:1})]),_:1})]),_:1})}}});const Dt=P(wt,[["__scopeId","data-v-68f0a73d"]]),St=O({__name:"AddContactModal",setup(c){const r=E(),o=()=>W.dismiss(null,"cancel");function I(){const v=new CustomEvent("idContactSearch",{detail:{idSuche:r.value}});window.dispatchEvent(v),W.dismiss(null,"confirm")}return(v,w)=>(y(),$(H,null,[t(a(F),null,{default:e(()=>[t(a(x),null,{default:e(()=>[t(a(B),{slot:"start"},{default:e(()=>[t(a(R),{color:"medium",onClick:o},{default:e(()=>[g("Abbrechen")]),_:1})]),_:1}),t(a(T),null,{default:e(()=>[g("Kontakt hinzufügen ...")]),_:1}),t(a(B),{slot:"end"},{default:e(()=>[t(a(R),{strong:!0,onClick:I},{default:e(()=>[g("Hinzufügen")]),_:1})]),_:1})]),_:1})]),_:1}),t(a(V),{class:"ion-padding"},{default:e(()=>[t(a(tt),null,{default:e(()=>[t(a(et),{modelValue:r.value,"onUpdate:modelValue":w[0]||(w[0]=D=>r.value=D),label:"Nach ID suchen","label-placement":"stacked",placeholder:"ID"},null,8,["modelValue"])]),_:1})]),_:1})],64))}}),bt=c=>(ut("data-v-fba4e8ce"),c=c(),dt(),c),kt=bt(()=>L("p",null,"query",-1)),yt=O({__name:"ContactsPage",setup(c){const r=E([]),o=z();D();const I=n=>{D().then(()=>{setTimeout(()=>{n.target.complete()},1e3)})};async function v(){r.value=[];const n=await C.graphql.request(pt,{user_id:o.getSessionID}),s=n.data.contacts.length;for(let i=0;i<s;i++){const m=n.data.contacts[i].contact,u=await C.graphql.request(N,{user_id:m}),h={username:u.data.userdetails[0]?u.data.userdetails[0].username:"",avatarSrc:u.data.userdetails[0]?u.data.userdetails[0].avatar_url:"",user_id:u.data.userdetails[0]?u.data.userdetails[0].user_id:"",email:u.data.userdetails[0]?u.data.userdetails[0].email:""};o.contactsContainUserWithID(h.user_id)||o.addToContactInformation(h),r.value.push(h)}}async function w(){r.value=[];for(let n=0;n<o.getContactInformation.length;n++)r.value.push(o.getContactInformation[n])}async function D(){r.value=[];try{const s=(await C.graphql.request(gt,{user_id:o.getSessionID})).data.contacts_aggregate.aggregate.count;o.getContactInformation.length<s?await v():await w()}catch(n){console.log(n),b.fire({icon:"error",title:"Fehler beim Laden der Kontakte"})}}function f(n){let s;for(s=0;s<r.value.length;s++)if(r.value[s].user_id===n)return!0;return!1}const l=async()=>{(await W.create({component:St})).present()};window.addEventListener("deleteUserWithId",n=>{at.fire({title:"Kontakt und zugehörige Nachrichten löschen?",showCancelButton:!0,confirmButtonText:"Löschen",denyButtonText:"Don't save",heightAuto:!1}).then(async s=>{if(s.isConfirmed){const i=n.detail.user_id;f(i)?(await C.graphql.request(nt,{user_id:o.getSessionID,contact:i})).error?b.fire({icon:"error",title:"Fehler beim Löschen des Kontaktes"}):(st.fire({icon:"success",title:"Kontakt erfolgreich gelöscht"}),r.value=r.value.filter(h=>h.user_id!==i),o.deleteContactInformationWithID(i),o.deleteFromActiveChats(i)):b.fire({icon:"error",title:"Kontakt existiert nicht ..."})}else b.fire({icon:"error",title:"Löschung abgebrochen"})})});async function _(n){return(await C.graphql.request(Ct,{user_id:n})).data.userdetails_aggregate.aggregate.count>0}return window.addEventListener("idContactSearch",async n=>{const s=n.detail.idSuche;if(f(s)){await K("Kontakt ist bereits in Liste ...");return}else if(await _(s)){const u=await ot("".concat(o.getSessionID,",").concat(s));if((await C.graphql.request(rt,{contact:s,user_id:o.getSessionID,friendship_hash:u})).error){await K("Fehler beim Hinzufügen des Kontaktes");return}else{await _t("Kontakt erfolgreich hinzugefügt");const S=await C.graphql.request(N,{user_id:s}),k={username:S.data.userdetails[0].username,avatarSrc:S.data.userdetails[0].avatar_url,user_id:S.data.userdetails[0].user_id,email:S.data.userdetails[0].email};r.value.push(k),o.contactsContainUserWithID(k.user_id)||o.addToContactInformation(k)}}}),(n,s)=>{const i=d("ion-refresher-content"),m=d("ion-refresher"),u=d("ion-label"),h=d("ion-item"),S=d("ion-list"),k=d("ion-button"),M=d("ion-footer");return y(),A(a(ct),null,{default:e(()=>[t(a(F),null,{default:e(()=>[t(a(x),null,{default:e(()=>[t(a(T),null,{default:e(()=>[g("Kontakte")]),_:1})]),_:1}),t(a(V),{fullscreen:!0},{default:e(()=>[t(m,{slot:"fixed","pull-factor":.5,"pull-min":100,"pull-max":200,onIonRefresh:s[0]||(s[0]=p=>I(p))},{default:e(()=>[t(i)]),_:1}),t(a(F),{collapse:"condense"},{default:e(()=>[t(a(x),null,{default:e(()=>[t(a(T),{size:"large"},{default:e(()=>[g("Contacts")]),_:1})]),_:1})]),_:1}),t(S,{lines:"full"},{default:e(()=>[(y(!0),$(H,null,lt(r.value,p=>(y(),A(h,{key:p},{default:e(()=>[t(u,null,{default:e(()=>[t(Dt,{avatar:p.avatarSrc,email:p.email,user:p.username,user_id:p.user_id},null,8,["avatar","email","user","user_id"])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1}),kt]),_:1}),t(M,null,{default:e(()=>[t(a(x),null,{default:e(()=>[t(k,{id:"addButton",shape:"round",onClick:l},{default:e(()=>[t(a(U),{slot:"icon-only",icon:a(it)},null,8,["icon"])]),_:1})]),_:1})]),_:1})]),_:1})}}});const Wt=P(yt,[["__scopeId","data-v-fba4e8ce"]]);export{Wt as default};
