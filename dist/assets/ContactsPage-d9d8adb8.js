import{d as T,u as N,B as F,r as h,o as y,c as z,w as e,a as t,b as a,a4 as k,e as H,f as U,a2 as M,an as j,i as p,t as W,j as J,k as G,ai as b,l as Q,O as E,_ as P,g as q,n as x,C as O,D as B,p as A,x as L,E as X,J as Y,q as V,F as $,V as C,S as Z,ao as tt,ah as et,ap as at,aq as nt,s as st,ar as ot,y as rt,z as it,A as lt}from"./index-881c955e.js";import{g as ct,a as R,p as ut}from"./methods-33cfe600.js";import{o as dt,S as ft,i as _t,j as K,k as mt,l as ht}from"./ShowContactDetailsModal-bead96cd.js";const gt={class:"image_container"},pt=["src"],Ct=T({__name:"ContactElement",props:{user:String,avatar:String,user_id:String,email:String},setup(c){const r=c,o=N(),v=F(null);function I(f,i,_){try{const n=new CustomEvent("openDialogue",{detail:{user:f,user_id:i,email:_}}),s=o.getAvatarUrlFromContactInformationForID(i),l=ct();if(o.activeChatsContainChatWithID(i))o.updateTimestampOfActiveChatWithID(i,l);else{const m={user:f,user_id:i,email:_,avatarUrl:s,lastAccessTimestamp:l};o.addToActiveChats(m),o.setCurrentDialoguePartner(m)}o.setLastActiveChatWasWithID(i),window.dispatchEvent(n)}catch(n){b.fire({title:"Error",text:"Dialog für Chat-Ansicht konnte nicht geöffnet werden"})}finally{Q.push("/tabs/dialogue")}}function w(f){try{const i=new CustomEvent("deleteUserWithId",{detail:{user_id:f}});window.dispatchEvent(i)}catch(i){b.fire({title:"Error",text:"Event zum Löschen des Nutzers konnte nicht veranlasst werden"})}o.resetCurrentDialoguePartner()}const D=async(f,i,_)=>{(await E.create({component:ft,componentProps:{avatarUrl:f,userId:i,email:_}})).present()};return dt(v,()=>{D(r.avatar,r.user_id,r.email)}),(f,i)=>{const _=h("ion-item-option"),n=h("ion-item-options"),s=h("ion-card-subtitle"),l=h("ion-item"),m=h("ion-item-sliding");return y(),z(m,null,{default:e(()=>[t(n,{side:"start"},{default:e(()=>[t(_,{color:"success"},{default:e(()=>[t(a(k),{slot:"icon-only",icon:a(H)},null,8,["icon"])]),_:1})]),_:1}),t(l,{onClick:i[0]||(i[0]=u=>I(c.user,c.user_id,c.email))},{default:e(()=>[U("div",{class:"onhover",ref_key:"htmlRef",ref:v},[U("div",gt,[U("img",{src:c.avatar,alt:"avatar"},null,8,pt)]),t(a(M),null,{default:e(()=>[t(a(j),null,{default:e(()=>[p(W(c.user),1)]),_:1}),t(s,null,{default:e(()=>[p(W(c.user_id),1)]),_:1}),t(s,null,{default:e(()=>[p(W(c.email),1)]),_:1})]),_:1})],512)]),_:1}),t(n,{side:"end"},{default:e(()=>[t(_,null,{default:e(()=>[t(a(k),{slot:"icon-only",icon:a(J)},null,8,["icon"])]),_:1}),t(_,{color:"danger",onClick:i[1]||(i[1]=u=>w(c.user_id))},{default:e(()=>[t(a(k),{slot:"icon-only",icon:a(G)},null,8,["icon"])]),_:1})]),_:1})]),_:1})}}});const vt=P(Ct,[["__scopeId","data-v-d449d4da"]]),It=T({__name:"AddContactModal",setup(c){const r=F(),o=()=>E.dismiss(null,"cancel");function v(){const I=new CustomEvent("idContactSearch",{detail:{idSuche:r.value}});window.dispatchEvent(I),E.dismiss(null,"confirm")}return(I,w)=>(y(),q($,null,[t(a(L),null,{default:e(()=>[t(a(x),null,{default:e(()=>[t(a(O),{slot:"start"},{default:e(()=>[t(a(B),{color:"medium",onClick:o},{default:e(()=>[p("Abbrechen")]),_:1})]),_:1}),t(a(A),null,{default:e(()=>[p("Kontakt hinzufügen ...")]),_:1}),t(a(O),{slot:"end"},{default:e(()=>[t(a(B),{strong:!0,onClick:v},{default:e(()=>[p("Hinzufügen")]),_:1})]),_:1})]),_:1})]),_:1}),t(a(V),{class:"ion-padding"},{default:e(()=>[t(a(X),null,{default:e(()=>[t(a(Y),{modelValue:r.value,"onUpdate:modelValue":w[0]||(w[0]=D=>r.value=D),label:"Nach ID suchen","label-placement":"stacked",placeholder:"ID"},null,8,["modelValue"])]),_:1})]),_:1})],64))}}),wt=c=>(it("data-v-39eda40b"),c=c(),lt(),c),Dt=wt(()=>U("p",null,"query",-1)),St=T({__name:"ContactsPage",setup(c){const r=F([]),o=N();D();const v=n=>{D().then(()=>{setTimeout(()=>{n.target.complete()},1e3)})};async function I(){r.value=[];const n=await C.graphql.request(mt,{user_id:o.getSessionID}),s=n.data.contacts.length;for(let l=0;l<s;l++){const m=n.data.contacts[l].contact,u=await C.graphql.request(K,{user_id:m}),g={username:u.data.userdetails[0]?u.data.userdetails[0].username:"",avatarSrc:u.data.userdetails[0]?u.data.userdetails[0].avatar_url:"",user_id:u.data.userdetails[0]?u.data.userdetails[0].user_id:"",email:u.data.userdetails[0]?u.data.userdetails[0].email:""};o.contactsContainUserWithID(g.user_id)||o.addToContactInformation(g),r.value.push(g)}}async function w(){r.value=[];for(let n=0;n<o.getContactInformation.length;n++)r.value.push(o.getContactInformation[n])}async function D(){r.value=[];try{const s=(await C.graphql.request(_t,{user_id:o.getSessionID})).data.contacts_aggregate.aggregate.count;o.getContactInformation.length<s?await I():await w()}catch(n){console.log(n),b.fire({icon:"error",title:"Fehler beim Laden der Kontakte"})}}function f(n){let s;for(s=0;s<r.value.length;s++)if(r.value[s].user_id===n)return!0;return!1}const i=async()=>{(await E.create({component:It})).present()};window.addEventListener("deleteUserWithId",n=>{Z.fire({title:"Kontakt und zugehörige Nachrichten löschen?",showCancelButton:!0,confirmButtonText:"Löschen",denyButtonText:"Don't save",heightAuto:!1}).then(async s=>{if(s.isConfirmed){const l=n.detail.user_id;f(l)?(await C.graphql.request(tt,{user_id:o.getSessionID,contact:l})).error?b.fire({icon:"error",title:"Fehler beim Löschen des Kontaktes"}):(et.fire({icon:"success",title:"Kontakt erfolgreich gelöscht"}),r.value=r.value.filter(g=>g.user_id!==l),o.deleteContactInformationWithID(l),o.deleteFromActiveChats(l)):b.fire({icon:"error",title:"Kontakt existiert nicht ..."})}else b.fire({icon:"error",title:"Löschung abgebrochen"})})});async function _(n){return(await C.graphql.request(ht,{user_id:n})).data.userdetails_aggregate.aggregate.count>0}return window.addEventListener("idContactSearch",async n=>{const s=n.detail.idSuche;if(f(s)){await R("Kontakt ist bereits in Liste ...");return}else if(await _(s)){const u=await at("".concat(o.getSessionID,",").concat(s));if((await C.graphql.request(nt,{contact:s,user_id:o.getSessionID,friendship_hash:u})).error){await R("Fehler beim Hinzufügen des Kontaktes");return}else{await ut("Kontakt erfolgreich hinzugefügt");const S=await C.graphql.request(K,{user_id:s}),d={username:S.data.userdetails[0].username,avatarSrc:S.data.userdetails[0].avatar_url,user_id:S.data.userdetails[0].user_id,email:S.data.userdetails[0].email};r.value.push(d),o.contactsContainUserWithID(d.user_id)||o.addToContactInformation(d)}}}),(n,s)=>{const l=h("ion-refresher-content"),m=h("ion-refresher"),u=h("ion-list"),g=h("ion-button"),S=h("ion-footer");return y(),z(a(rt),null,{default:e(()=>[t(a(L),null,{default:e(()=>[t(a(x),null,{default:e(()=>[t(a(A),null,{default:e(()=>[p("Kontakte")]),_:1})]),_:1}),t(a(V),{fullscreen:!0},{default:e(()=>[t(m,{slot:"fixed","pull-factor":.5,"pull-min":100,"pull-max":200,onIonRefresh:s[0]||(s[0]=d=>v(d))},{default:e(()=>[t(l)]),_:1}),t(a(L),{collapse:"condense"},{default:e(()=>[t(a(x),null,{default:e(()=>[t(a(A),{size:"large"},{default:e(()=>[p("Contacts")]),_:1})]),_:1})]),_:1}),t(u,{lines:"full"},{default:e(()=>[(y(!0),q($,null,st(r.value,d=>(y(),q("div",{key:d},[t(vt,{avatar:d.avatarSrc,email:d.email,user:d.username,user_id:d.user_id},null,8,["avatar","email","user","user_id"])]))),128))]),_:1})]),_:1}),Dt]),_:1}),t(S,null,{default:e(()=>[t(a(x),null,{default:e(()=>[t(g,{id:"addButton",shape:"round",onClick:i},{default:e(()=>[t(a(k),{slot:"icon-only",icon:a(ot)},null,8,["icon"])]),_:1})]),_:1})]),_:1})]),_:1})}}});const Ut=P(St,[["__scopeId","data-v-39eda40b"]]);export{Ut as default};
